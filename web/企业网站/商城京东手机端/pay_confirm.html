<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
		<title>充值确认</title>
    	<meta name="author" content="10023.m.jd.com">
        			<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	            <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="format-detection" content="telephone=no">
		<link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon.png?v=jd2015012915"/>
		<link rel="stylesheet" type="text/css" href="css/index.css?v=jd2015012915" charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="css/base.css?v=jd2015012915" charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="css/base2013.css?v=jd2015012915" charset="utf-8"/>
		<script type="text/javascript" src="js/zepto.min.js?v=jd2015012915"></script>
        <script type="text/javascript">
			window.jQuery=window.Zepto;
		</script>
		
				<div class="new-header">
        	<a href="javascript:pageBack();" class="new-a-back" id="backUrl"><span>返回</span></a>
							<h2>充值</h2>
			            <a href="javascript:void(0)" id="btnJdkey" class="new-a-jd"><span>京东键</span></a>
    	</div>
		<div class="new-jd-tab" style="display:none" id="jdkey">
        	<div class="new-tbl-type">
                <a href="index.html" class="new-tbl-cell">
                	<span class="icon">首页</span>
					<p style="color:#6e6e6e;">首页</p>
                </a>
                <a href="cat.html" class="new-tbl-cell">
                	<span class="icon2">分类搜索</span>
					<p style="color:#6e6e6e;">分类搜索</p>
                </a>
                <a href="cart.html?sid=bfd5d5fa6afa2d31344dd42eb76b7d68" id="html5_cart" class="new-tbl-cell">
                	<span class="icon3">购物车</span>
					<p style="color:#6e6e6e;">购物车</p>
                </a>
                <a href="http://m.jd.commember_index.html" class="new-tbl-cell">
                	<span class="icon4">我的京东</span>
					<p style="color:#6e6e6e;">我的京东</p>
                </a>
            </div>
        </div>
			
				<script type="text/javascript" src="js/jquery-1.6.2.min.js?v=jd2015012915"></script>
				
		<script type="text/javascript" src="js/common.js?v=jd2015012915"></script>
		<script type="text/javascript" src="js/common.js?v=jd2015012915"></script>
		<script type="text/javascript" src="js/spin.min.js?v=jd2015012915"></script>
				<link rel="stylesheet" type="text/css" href="css/confirm.css?v=jd2015012915" charset="utf-8"/>	
						<style>.form-box .band-num .item .label {width: 87px;}</style>
	</head>
	
<body id="body">
	<div class="window-pop" id="_confirm" style="position:absolute;z-index:9999;display:none;min-height:124px">
        <div class="tip-con" id="_confirmMsg" style="line-height:25px;min-height:80px;margin:20px 0 10px">&nbsp;&nbsp;</div>
        <div class="tip-btns">
            <a href="javascript:void(0)" id="_confirmBtn" class="left-btn">确定</a>
            <a href="javascript:void(0)" id="_cancelBtn" class="right-btn">取消</a>
        </div>
    </div>
    <div class="window-pop" id="_alert" style="position:absolute;z-index:9999;display:none;min-height:124px">
        <div class="tip-con" id="_alertMsg" style="line-height:25px;min-height:80px;margin:20px 0 10px">&nbsp;&nbsp;</div>
        <div class="tip-btns">
            <a href="javascript:void()" id="_alertBtn" class="left-btn" style="border-right:0px solid #f7f2ee;;width:270px">确定</a>
        </div>
    </div>
	<div class="window-pop" id="_calert" style="position:absolute;z-index:9999;display:none;min-height:124px">
        <div class="tip-con" id="_calertMsg" style="line-height:25px;min-height:80px;margin:20px 0 10px">&nbsp;&nbsp;</div>
        <div class="tip-btns">
            <a href="javascript:void()" id="_calertBtn" class="left-btn" style="border-right:0px solid #f7f2ee;;width:270px">确定</a>
        </div>
    </div>
    
<div style="height:100%;width:100%;z-index:1001;position:absolute;opacity:1.0;overflow:hidden" id="chongzhi_wait" ></div>
<div class="sub-head">充值确认</div>
<div class="main">
    <div class="form-box">
        <div class="rechargecon">
            <div>手机号：<a href="tel:18005151538">18005151538</a></div>
            <div>充值金额：20.00元</div>
            <div>归属地：江苏电信</div>
            <div>应付总价：<span class="f-red1">19.80元 </span></div>
        </div>
        <div class="sub-head">支付方式</div>
        <div class="rechargecon">
            <div><input type="radio" checked="checked" name="payType" value="单选">在线支付<span id="payType_desc" style="color:gray;"></span></div>            
        </div>
        
        		<input type="hidden" id="mobile" name="mobile" value="18005151538"/>
		<input type="hidden" id="facePrice" name="facePrice" value="20.00"/>
		<input type="hidden" id="jdPrice" name="jdPrice"  value="19.80"/>
		<input type="hidden" id="discount" name="discount" value=""/>
		<input type="hidden" id="dxqId" name="dxqId" value=""/>
		<input type="hidden" id="dxqType" name="dxqType" value=""/>
		
	
        <a id="submit" class="submit-btn btn-red">确认付款</a>
    </div>
</div>
<input type="hidden" id="payHost" value="https://pay.m.jd.com">
<input type="hidden" id="sid" value="bfd5d5fa6afa2d31344dd42eb76b7d68">
<input type="hidden" id="type" name="type" value="1"/>
<script type="text/javascript" src="js/chongzhi.js?v=jd2015012915"></script> 		
<script>

	
	var spiner=createSpinner();
	var submitOrder= function(){
		if('T'=='F'){		
			return false;
		}
		
		//增加优惠券支付逻辑
		var dxqId = $('#dxqId').val();		
		var dxqType = $('#dxqType').val();
		var discount = $('#discount').val();
		var payPassword = $('#payPassword').val();
		var jdPrice = $('#jdPrice').val();
		
		if(dxqId!="" && dxqType!="" && discount!="" && jdPrice != ""){
			if(payPassword== null || payPassword == "") {
				alert("请输入支付密码");
				$('#payPassword').focus();
				return false;
			}else{				
				payPassword = hex_md5(payPassword);				
			}
			showChongZhiSpiner(spiner);
			jQuery.get("/chongzhi/submitOrder.json?sid=bfd5d5fa6afa2d31344dd42eb76b7d68",
			{mobile:$("#mobile").val(),facePrice:$("#facePrice").val(),area:12,isp:2,"type":$("#type").val(),"dxqId":dxqId,"dxqType":dxqType,"payPassword":payPassword},
			function(data){ 
				if(data.success!=null&&data.success!='F'){
					var url = "";
					//跳订单详情页 
					if(dxqType!=null && dxqType == "3"){
						url="/chongzhi/queryOrderDetail.action?orderId="+data.orderId;
					}else{					
						var payHost = $('#payHost').val();
						url = payHost+"/pay/pay.action?orderId="+data.orderId+"&orderKind=2";
					}
					if(!!$('#sid').val()){
						url += '&sid='+$('#sid').val();
					}
					$("#payType_4").attr("checked",false);
					removeSelectDxq();	
					window.location.replace(url);
					hideChongZhiSpiner(spiner);
				}else{
					if(data.checkPwd!=null&&data.checkPwd=='E'){
											
						alert('您的支付密码输入错误，请重新输入');
						$('#payPassword').val("");
						
					}else{
						alert('您选择的面额暂时缺货，请选择其它面额');
					}
					
					hideChongZhiSpiner(spiner);
					return false;
				}
				},'json');
		}else{
			showChongZhiSpiner(spiner);
			jQuery.get("/chongzhi/submitOrder.json?sid=bfd5d5fa6afa2d31344dd42eb76b7d68",
			{mobile:$("#mobile").val(),facePrice:$("#facePrice").val(),area:12,isp:2,"type":$("#type").val()},
			function(data){ 
				if(data.success!=null&&data.success!='F'){
					var payHost = $('#payHost').val();
					var url = payHost+"/pay/pay.action?orderId="+data.orderId+"&orderKind=2";
					if(!!$('#sid').val())
						url += '&sid='+$('#sid').val();
					window.location.replace(url);
					hideChongZhiSpiner(spiner);
				}else{
					alert('您选择的面额暂时缺货，请选择其它面额');
					hideChongZhiSpiner(spiner);
					return false;
				}
				},'json');
			}
		
	}
	
	
	
	//add by langgu 2015/2/9 增加优惠券支持
	
/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

/*
 * Configurable variables. You may need to tweak these to be compatible with
 * the server-side, but the defaults work in most cases.
 */
var hexcase = 0;  /* hex output format. 0 - lowercase; 1 - uppercase        */
var b64pad  = ""; /* base-64 pad character. "=" for strict RFC compliance   */
var chrsz   = 8;  /* bits per input character. 8 - ASCII; 16 - Unicode      */

/*
 * These are the functions you'll usually want to call
 * They take string arguments and return either hex or base-64 encoded strings
 */
function hex_md5(s){ return binl2hex(core_md5(str2binl(s), s.length * chrsz));}
function b64_md5(s){ return binl2b64(core_md5(str2binl(s), s.length * chrsz));}
function str_md5(s){ return binl2str(core_md5(str2binl(s), s.length * chrsz));}
function hex_hmac_md5(key, data) { return binl2hex(core_hmac_md5(key, data)); }
function b64_hmac_md5(key, data) { return binl2b64(core_hmac_md5(key, data)); }
function str_hmac_md5(key, data) { return binl2str(core_hmac_md5(key, data)); }

/*
 * Perform a simple self-test to see if the VM is working
 */
function md5_vm_test()
{
  return hex_md5("abc") == "900150983cd24fb0d6963f7d28e17f72";
}

/*
 * Calculate the MD5 of an array of little-endian words, and a bit length
 */
function core_md5(x, len)
{
  /* append padding */
  x[len >> 5] |= 0x80 << ((len) % 32);
  x[(((len + 64) >>> 9) << 4) + 14] = len;

  var a =  1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d =  271733878;

  for(var i = 0; i < x.length; i += 16)
  {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;

    a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
    d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
    c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);
    b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
    a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
    d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);
    c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
    b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
    a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);
    d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
    c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
    b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
    a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);
    d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
    c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
    b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);

    a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
    d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
    c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);
    b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
    a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
    d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);
    c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
    b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
    a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);
    d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
    c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
    b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);
    a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
    d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
    c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);
    b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);

    a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
    d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
    c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);
    b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
    a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
    d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);
    c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
    b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
    a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);
    d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
    c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
    b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);
    a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
    d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
    c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);
    b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);

    a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
    d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);
    c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
    b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
    a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);
    d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
    c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
    b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
    a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);
    d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
    c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
    b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);
    a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
    d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
    c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);
    b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);

    a = safe_add(a, olda);
    b = safe_add(b, oldb);
    c = safe_add(c, oldc);
    d = safe_add(d, oldd);
  }
  return Array(a, b, c, d);

}

/*
 * These functions implement the four basic operations the algorithm uses.
 */
function md5_cmn(q, a, b, x, s, t)
{
  return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t)
{
  return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t)
{
  return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t)
{
  return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t)
{
  return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}

/*
 * Calculate the HMAC-MD5, of a key and some data
 */
function core_hmac_md5(key, data)
{
  var bkey = str2binl(key);
  if(bkey.length > 16) bkey = core_md5(bkey, key.length * chrsz);

  var ipad = Array(16), opad = Array(16);
  for(var i = 0; i < 16; i++)
  {
    ipad[i] = bkey[i] ^ 0x36363636;
    opad[i] = bkey[i] ^ 0x5C5C5C5C;
  }

  var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz);
  return core_md5(opad.concat(hash), 512 + 128);
}

/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */
function safe_add(x, y)
{
  var lsw = (x & 0xFFFF) + (y & 0xFFFF);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return (msw << 16) | (lsw & 0xFFFF);
}

/*
 * Bitwise rotate a 32-bit number to the left.
 */
function bit_rol(num, cnt)
{
  return (num << cnt) | (num >>> (32 - cnt));
}

/*
 * Convert a string to an array of little-endian words
 * If chrsz is ASCII, characters >255 have their hi-byte silently ignored.
 */
function str2binl(str)
{
  var bin = Array();
  var mask = (1 << chrsz) - 1;
  for(var i = 0; i < str.length * chrsz; i += chrsz)
    bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);
  return bin;
}

/*
 * Convert an array of little-endian words to a string
 */
function binl2str(bin)
{
  var str = "";
  var mask = (1 << chrsz) - 1;
  for(var i = 0; i < bin.length * 32; i += chrsz)
    str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & mask);
  return str;
}

/*
 * Convert an array of little-endian words to a hex string.
 */
function binl2hex(binarray)
{
  var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
  var str = "";
  for(var i = 0; i < binarray.length * 4; i++)
  {
    str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +
           hex_tab.charAt((binarray[i>>2] >> ((i%4)*8  )) & 0xF);
  }
  return str;
}

/*
 * Convert an array of little-endian words to a base-64 string
 */
function binl2b64(binarray)
{
  var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  var str = "";
  for(var i = 0; i < binarray.length * 4; i += 3)
  {
    var triplet = (((binarray[i   >> 2] >> 8 * ( i   %4)) & 0xFF) << 16)
                | (((binarray[i+1 >> 2] >> 8 * ((i+1)%4)) & 0xFF) << 8 )
                |  ((binarray[i+2 >> 2] >> 8 * ((i+2)%4)) & 0xFF);
    for(var j = 0; j < 4; j++)
    {
      if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;
      else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);
    }
  }
  return str;
}
	
	
 /**
  ** 减法函数，用来得到精确的减法结果
  ** 说明：javascript的减法结果会有误差，在两个浮点数相减的时候会比较明显。这个函数返回较为精确的减法结果。
  ** 调用：accSub(arg1,arg2)
  ** 返回值：arg1加上arg2的精确结果
  **/
 function accSub(arg1, arg2) {
     var r1, r2, m, n;
     try {
         r1 = arg1.toString().split(".")[1].length;
     }
     catch (e) {
         r1 = 0;
     }
     try {
         r2 = arg2.toString().split(".")[1].length;
     }
     catch (e) {
         r2 = 0;
     }
     m = Math.pow(10, Math.max(r1, r2)); //last modify by deeka //动态控制精度长度
     n = (r1 >= r2) ? r1 : r2;
     return ((arg1 * m - arg2 * m) / m).toFixed(n);
 }
		

	

	
$(document).ready(function(){
		hideChongZhiSpiner(spiner);
		$("#body").addClass("rechange");
		$("#submit").click(submitOrder);
		if('html5'=='html5'){
		  showFoot("bfd5d5fa6afa2d31344dd42eb76b7d68",null,null);
		 }
		 
		 		});
</script>
                <div style="">
                	    			<img src="/ja.jsp?&amp;utmn=478350055&amp;utmr=http%3A%2F%2Fvm.m.jd.com%2Fchongzhi%2Findex.action%3Fv%3Dt%26sid%3Dbfd5d5fa6afa2d31344dd42eb76b7d68&amp;utmp=%2Fchongzhi%2FchongzhiConfirm.action%3Fsid%3Dbfd5d5fa6afa2d31344dd42eb76b7d68%26area%3D12%26isp%3D2%26facePrice%3D20.00%26type%3D1%26mobile%3D18005151538&amp;guid=ON&jav=html5&pin=hjl416148489&utmac=MO-J2011-1" />
    		    	        </div>
		
		
	    <script type="text/javascript" src="js/mping.min.js"></script>
    <script type="text/javascript">
        try{
            var pv= new MPing.inputs.PV();   //构造pv 请求
            var mping = new MPing();        //构造上报实例
            mping.send(pv);                //上报pv
        } catch (e){}
    </script>
		
</body>
</html>
