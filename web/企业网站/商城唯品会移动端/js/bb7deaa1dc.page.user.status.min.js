var pageUserStatus=function(a,b){var c={},c={noty:function(a,c,d){b.flicker(a,c,!1,1,5,d)},confusion:function(a,b,c){var d="",e=Date.parse(new Date)/1e3,d=rstr2b64(a)+":"+rstr2b64(e.toString())+":"+rstr2b64(b),c=arguments[2]?arguments[2]:"";return c.length>0&&(d+=":"+rstr2b64(c)),d}},d={amountDisable:"disabled",events:{verifyLogin:"click.action.verify.login",verifyReg:"click.action.verify.reg",verifySex:"click.action.verify.sex",clear:"click.action.clear.text",verifyMobile:"click.action.verify.mobile",verifyReg:"click.action.verify.Reg",verifyCode:"click.action.verify.code"}},e={module:$('[data-validform="loginForm"]'),userVerifyLogin:'[data-action="loginCheck"]',moduleReg:$('[data-validform="regForm"]'),userVerifyReg:'[data-action="regCheck"]',userClearCon:".btn-delete",register:{module:$('[data-validform="checkMobileForm"]'),moduleReg:$('[data-validform="regMobileForm"]'),userVerifyMobile:'[data-action="verifyMobile"]',userRegMobile:'[data-action="regMobile"]',userVerifyCode:'[data-action="getCode"]'},input:{name:'input[name="inputName"]',psw:'input[name="inputPsw"]',remember:'input[name="inputRemember"]',captcha:'input[name="captcha"]',sex:'input[name="sex"]',phone:"#inputMoblie",code:"#inputCode"}},f={validObj:[],triggerEventFocus:["focus","blur"],triggerEventKeyDown:["keyup","change"],config:{tiptype:2,tipSweep:!1,showAllError:!1,postonce:!0,ajaxPost:!1},action:{validLogin:function(a){f.formLoginVal(a,$(this),"act_login")},validReg:function(a){f.formRegVal(a,$(this),"act_register")},clear:function(){b.empty.call($(this))},verifyMobile:function(a){f.formMobileVal(a,$(this),"next")},verifyReg:function(a){f.formMobileRegVal(a,$(this),"reg_and_bind")},codes:function(a){f.codes(a,$(this),"code")}},initConfig:function(a){var c=$.extend(!0,f.config,b.validate.util.tipmsg,a||{});return c},formValid:function(a,c,d){var e,g=a.curform,h=!0,i=f.initConfig(a);return"posting"===g[0].status?!1:i.postonce&&"posted"===g[0].status?!1:(g.find("[datatype]").each(function(){if(c)return!1;if($(this).is(":hidden")||"dataIgnore"===$(this).data("dataIgnore"))return!0;if(!$(this).attr("datatype"))return!1;var a=b.validate.util.getValue.call(g,$(this)),d=$(this);return e=b.validate.util.regcheck.call(g,$(this).attr("datatype"),a,$(this),i),e.passed?void 0:i.showAllError?(h&&(h=!1),!0):(d.focus(),h=!1,!1)}),h?(g[0].status="posting",d(g)):!1)},formLoginVal:function(a,d,g){var h={elem:d,curform:e.module,onCorrect:null,name:d.parent().prev().find(e.input.name),psw:d.parent().prev().find(e.input.psw),remember:e.module.find(e.input.remember+":checked").length?1:0,type:g};f.formValid(h,!1,function(a){if(h.layerStatus=a.find("#li_captcha"),h.layerStatus.length&&!h.layerStatus.is(":hidden")){var d=a.find(e.input.captcha);if(d.val().length<1)return d.focus(),!1}var f=c.confusion(h.name.val(),hex_md5(h.psw.val())),g=a.find('input[name="back_act"]').val();h.elem.html("&nbsp;").attr("disabled",!0),$("<div />",{"class":"navbar-mask"}).html('<img src="view-src/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 提交中...').appendTo(h.elem.parent());var i={url:"login.html?",data:{step:h.type,back_act:g,data:f,captcha:d?d.val():"",remember:h.remember},dataType:"json",type:"POST"};i.error=function(){a[0].status="normal",h.elem.html("登 录").attr("disabled",!1).next().remove(),b.dialogBlack("网络加载异常，请刷新页面重试")},i.success=function(c){if(a[0].status="normal",h.elem.html("登 录").attr("disabled",!1).next().remove(),!c||null==c||void 0==c)return b.dialogBlack("网络加载异常，请刷新页面重试"),!1;switch(c.error){case"error":b.dialogBlack(c.title),1==c.use_captcha&&h.layerStatus.show(),d&&d.length&&d.parent().next("#captcha").attr("src","captcha.html?t="+Math.random()+"&type=0");break;case"0":a[0].status="posted",c.url.length&&(self.location.href=c.url);break;default:b.dialogBlack(c.msg)}},$.ajax(i)})},formRegVal:function(a,d,g){var h={elem:d,curform:e.moduleReg,onCorrect:null,name:d.parent().prev().find(e.input.name),psw:d.parent().prev().find(e.input.psw),sex:d.parent().prev().find(e.input.sex+":checked").length?parseInt(d.parent().prev().find(e.input.sex+":checked").val()):null,type:g};f.formValid(h,!1,function(a){if(null==h.sex)return a[0].status="normal",$(e.input.sex).trigger(f.triggerEventFocus[1]),!1;if(h.layerStatus=a.find("#li_captcha"),h.layerStatus.length&&!h.layerStatus.is(":hidden")){var d=a.find(e.input.captcha);if(d.val().length<1)return d.focus(),!1}var g=c.confusion(h.name.val(),hex_md5(h.psw.val()));h.elem.html("&nbsp;").attr("disabled",!0),$("<div />",{"class":"navbar-mask"}).html('<img src="view-src/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 提交中...').appendTo(h.elem.parent());var i={url:"reg.html?",data:{step:h.type,data:g,sex:h.sex,captcha:d?d.val():""},dataType:"json",type:"POST"};i.error=function(){a[0].status="normal",h.elem.html("注 册").attr("disabled",!1).next().remove(),b.dialogBlack("网络加载异常，请刷新页面重试")},i.success=function(c){if(a[0].status="normal",h.elem.html("注 册").attr("disabled",!1).next().remove(),!c||null==c||void 0==c)return b.dialogBlack("网络加载异常，请刷新页面重试"),!1;switch(c.error){case"error":b.dialogBlack(c.title),1==c.use_captcha&&h.layerStatus.show(),d&&d.length&&d.parent().next("#captcha").attr("src","captcha.html?t="+Math.random()+"&type=1"),1==c.user_exists&&h.name.focus();break;case"0":a[0].status="posted",c.url.length&&(self.location.href=c.url);break;default:b.dialogBlack(c.msg)}},$.ajax(i)})},formMobileVal:function(a,c,d){var h={elem:c,curform:e.register.module,onCorrect:null,phone:c.parent().prev().find(e.input.phone),type:d};f.formValid(h,!1,function(a){h.elem.html("&nbsp;").attr("disabled",!0),$("<div />",{"class":"navbar-mask"}).html('<img src="view-src/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 提交中...').appendTo(h.elem.parent()),$.when(g.request.isMobileAvailable(h.phone.val())).then(function(b){h.elem.html("下一步").attr("disabled",!1).next().remove(),a[0].status="posted",a.fadeOut(0,function(){$(this).next().show()[0].mobile=h.phone.val(),$(this).remove()}),b.data&&b.data.count&&b.data.count>0&&f.codes(void 0,$(e.register.userVerifyCode),"code")},function(c){a[0].status="normal",h.elem.html("下一步").attr("disabled",!1).next().remove(),13001==c.code?b.showDialog("该手机号已注册，请直接登录或重新输入新的手机号",{width:300,title:"",setClass:"ui-model-double",isCenter:!0,overClose:!1,buttons:!0,setResize:!1,type:"defined",buttonsCus:[{name:"重新输入",attribute:!1},{name:"去登录",attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1),$(e.input.phone).val("").focus()},onDoCompleteTo:function(a,b){self.location.href="login.html",b.oncomplete(!1)}}):b.dialogBlack((c||{}).msg||"未知错误")})})},formMobileRegVal:function(a,d,h){var i={elem:d,curform:e.register.moduleReg,onCorrect:null,mobile:e.register.moduleReg[0].mobile,psw:d.parent().prev().find(e.input.psw),code:d.parent().prev().find(e.input.code),type:h};f.formValid(i,!1,function(a){var d=c.confusion(i.mobile,hex_md5(i.psw.val()));i.elem.html("&nbsp;").attr("disabled",!0),$("<div />",{"class":"navbar-mask"}).html('<img src="view-src/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 提交中...').appendTo(i.elem.parent()),$.when(g.request.isMobileRegisterAndBind({data:d,code:i.code.val()})).then(function(b){i.elem.html("注 册").attr("disabled",!1).next().remove(),a[0].status="posted",b.url.length&&(self.location.href=b.url)},function(c){a[0].status="normal",i.elem.html("注 册").attr("disabled",!1).next().remove(),b.dialogBlack((c||{}).msg||"未知错误")})})},codes:function(a,c){if(e.register.moduleReg[0].mobile&&!c.attr("disabled")){var d={curform:e.register.moduleReg,text:"重新获取"};c.attr("mars_sead")?setTimeout(function(){c.removeAttr("mars_sead")},12):c.html()==d.text&&Mar.Seed.request("button","click","register_resend_btn"),c.attr("disabled",!0).addClass("disabled").html('<img src="view-src/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" />'),$.when(g.request.isMobileCode(d.curform[0].mobile)).then(function(a){var e={elem:c,startTime:a.data.count,timeStamp:{day:"",hour:"",min:"",sec:"秒"},timeFormat:!1,action:"defined",halfwayTime:!1,callback:!0,message:"后重新获取",callbackFunction:function(){this.attr("disabled",!1).removeClass("disabled").html(d.text)},onDoCallback:!0,onDoComplete:function(a,b){b.complete(!0)}};b.countDown(e),$("#sendMobileTip").show().html("短信验证码已发送至"+d.curform[0].mobile),b.dialogBlack("验证码发送成功，请注意查收短信")},function(a){c.attr("disabled",!1).removeClass("disabled").html(d.text),b.dialogBlack((a||{}).msg||"未知错误")})}},checkValid:function(a,c,d){{var e=a.curform;a.elem[0]}switch(focusTxt=a.elem.attr("placeholder")||"",returnObj=f.initConfig(a),c){case"blurValidator":var g=b.validate.util.getValue.call(e,a.elem),h=!0;if(!a.elem.attr("datatype"))return!1;switch(returnObj.evType){case"focus":focusTxt.length&&a.elem.attr("placeholder","");break;case"blur":"password"!=a.elem.attr("type")||focusTxt.length?a.elem.attr("placeholder",returnObj.onEmpty):a.elem.attr("placeholder",returnObj.onError)}return h=b.validate.util.regcheck.call(e,a.elem.attr("datatype"),g,a.elem,returnObj),h.passed?(b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),a.elem.parents("li").removeClass("error"),d(h),!0):(a.elem.parents("li").addClass("error"),b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),d(h),!1);case"customValidator":var g=b.validate.util.getValue.call(e,a.elem),h={info:null,passed:!1,type:3};return""===g?(h.passed=!1,h.type=4,h.info=returnObj.onEmpty):(h.passed=!0,h.type=2,h.info=returnObj.onCorrect),h.passed?(b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),a.elem.parents("li").removeClass("error"),d(h),!0):(a.elem.parents("li").addClass("error"),b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),d(h),!1);default:return!1}},checkPhone:function(a){var b=$(this),c={elem:b,curform:e.register.module,onShow:"请输入手机号码",onFocus:"短信验证码将发送至该手机号，请认真填写",onCorrect:"",onEmpty:"请输入手机号码",onError:"请输入有效的手机号码",evType:a.type};f.checkValid(c,"blurValidator",function(a){a.passed?c.elem.parents("ul").next().find(e.register.userVerifyMobile).attr("disabled",!1).removeClass("disabled"):c.elem.parents("ul").next().find(e.register.userVerifyMobile).attr("disabled",!0).addClass("disabled")},!1)},checkName:function(a){var b=$(this),c={elem:b,curform:e.module,onShow:b.attr("placeholder"),onFocus:b.attr("placeholder"),onCorrect:"",onEmpty:b.attr("placeholder"),onError:"账号有误，请重新输入",evType:a.type};f.checkValid(c,"blurValidator",function(){},!1)},checkPassWord:function(a){if(e.module.length){var c=$(this),d={elem:c,curform:e.module,onShow:"请输入密码",onFocus:"6-20位字母或数字组成",onCorrect:"",onEmpty:"请输入6-20位密码",onError:"6-20位字母或数字组成",evType:a.type},g=b.validate.util.getValue.call(d.curform,d.elem);g.length>0&&g.length<6&&(d.onError="密码太短,6-20位字母或数字组成"),f.checkValid(d,"blurValidator",function(){},!1)}else if(e.register.moduleReg.length){var c=$(this),d={elem:c,curform:e.register.moduleReg,onShow:"请输入密码",onFocus:"6-20位字母或数字组成",onCorrect:"",onEmpty:"请输入6-20位密码",onError:"6-20位字母或数字组成",evType:a.type},g=b.validate.util.getValue.call(d.curform,d.elem);g.length>0&&g.length<6&&(d.onError="密码太短,6-20位字母或数字组成"),f.checkValid(d,"blurValidator",function(a){a.passed?e.register.moduleReg.find(e.register.userRegMobile).attr("disabled",!1).removeClass("disabled"):e.register.moduleReg.find(e.register.userRegMobile).attr("disabled",!0).addClass("disabled")},!1)}},checkSex:function(a){var b=$(this),c={elem:b,curform:e.moduleReg,onShow:"请选择性别",onFocus:"请选择性别",onCorrect:"",onEmpty:"请选择性别",onError:"请选择性别",evType:a.type};f.checkValid(c,"customValidator",function(a){a.passed?c.elem.parents("li").next().removeClass("error"):c.elem.parents("li").next().addClass("error")},!1)},checkCaptcha:function(a){var b=$(this),c={elem:b,curform:e.module,onShow:"请输入验证码",onFocus:"请输入验证码，填写有效的验证码",onCorrect:"",onEmpty:"请输入验证码",onError:"请输入有效的验证码",evType:a.type};f.checkValid(c,"blurValidator",function(){},!1)},checkCode:function(a){var b=$(this),c={elem:b,curform:e.module,onShow:"请输入验证码",onFocus:"请输入验证码，填写有效的验证码",onCorrect:"",onEmpty:"请输入验证码",onError:"请输入有效的验证码",evType:a.type};f.checkValid(c,"blurValidator",function(a){a.passed?$(e.userVerifyCode).attr("disabled",!1).removeClass("disabled").addClass("btn-purple"):$(e.userVerifyCode).attr("disabled",!0).addClass("disabled").removeClass("btn-purple")},!1)}},g={request:{isMobileAvailable:function(a){return g.ajax({url:"reg.html",data:{step:"isMobileAvailable",mobile:a},dataType:"json",type:"POST"})},isMobileCode:function(a){return g.ajax({url:"reg.html",data:{step:"sendValidateCode",mobile:a},dataType:"json",type:"POST"})},isMobileRegisterAndBind:function(a){return g.ajax({url:"reg.html",data:{step:"registerAndBindMobile",data:a.data,code:a.code},dataType:"json",type:"POST"})}},ajax:function(a,c){if(!a.url)return b.dialogBlack("request url is need!"),!1;a.url.indexOf("?s=")>-1&&(a.url=a.url.substring(0,a.url.indexOf("?s="))),a.url=a.url+"?s="+(new Date).getTime(),c=void 0!=c?c:1,a.type?a.type:a.type="GET",a.data?a.data:a.data={},a.dataType?a.dataType:(dataType="json")(a.timeout)?a.timeout:a.timeout=5e3,delete a.success,delete a.error,delete a.complete;var d=function(){function b(b,c){c?g.ajax(a,--c).done(d.resolve).fail(d.reject):d.reject(b)}var d=$.Deferred();return $.ajax(a).done(function(a){a&&1==a.code?d.resolve(a):b(a,0)}).fail(function(a,d){b(d||{message:"网络请求失败，请重试"},c)}),d.promise()};return d()}},h={checkFormInput:function(){var a=$(e.input.name),b=$(e.input.psw),c=$(e.input.sex),d=$(e.input.captcha),g=$(e.input.phone),h=($(e.input.rpsw),$(e.input.code));a.on(f.triggerEventFocus[0],f.checkName).on(f.triggerEventFocus[1],f.checkName),a.on(f.triggerEventKeyDown[0],f.checkName).on(f.triggerEventKeyDown[1],f.checkName),b.on(f.triggerEventFocus[0],f.checkPassWord).on(f.triggerEventFocus[1],f.checkPassWord),b.on(f.triggerEventKeyDown[0],f.checkPassWord).on(f.triggerEventKeyDown[1],f.checkPassWord),c.on(f.triggerEventFocus[1],f.checkSex),d.on(f.triggerEventFocus[0],f.checkCaptcha).on(f.triggerEventFocus[1],f.checkCaptcha),d.on(f.triggerEventKeyDown[0],f.checkCaptcha).on(f.triggerEventKeyDown[1],f.checkCaptcha),g.on(f.triggerEventFocus[0],f.checkPhone).on(f.triggerEventFocus[1],f.checkPhone),g.on(f.triggerEventKeyDown[0],f.checkPhone).on(f.triggerEventKeyDown[1],f.checkPhone),h.on(f.triggerEventFocus[0],f.checkCode).on(f.triggerEventFocus[1],f.checkCode),h.on(f.triggerEventKeyDown[0],f.checkCode).on(f.triggerEventKeyDown[1],f.checkCode)}},i={events:function(){e.module.off(d.events.verifyLogin,e.userVerifyLogin).on(d.events.verifyLogin,e.userVerifyLogin,f.action.validLogin),$(e.userClearCon).off(d.events.clear).on(d.events.clear,f.action.clear),e.moduleReg.off(d.events.verifyReg,e.userVerifyReg).on(d.events.verifyReg,e.userVerifyReg,f.action.validReg),$(e.input.sex).off(d.events.verifySex).on(d.events.verifySex,f.checkSex),e.register.module.off(d.events.verifyMobile,e.register.userVerifyMobile).on(d.events.verifyMobile,e.register.userVerifyMobile,f.action.verifyMobile),e.register.moduleReg.off(d.events.verifyCode,e.register.userVerifyCode).on(d.events.verifyCode,e.register.userVerifyCode,f.action.codes).off(d.events.verifyReg,e.register.userRegMobile).on(d.events.verifyReg,e.register.userRegMobile,f.action.verifyReg)}},j={init:function(){i.events(),h.checkFormInput()}};$(function(){j.init()})}(window,hawk);