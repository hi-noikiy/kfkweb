!function($){"use strict";var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(a){if(null===a)return"null";var b,c,d,e,f=$.type(a);if("undefined"===f)return void 0;if("number"===f||"boolean"===f)return String(a);if("string"===f)return $.quoteString(a);if("function"==typeof a.toJSON)return $.toJSON(a.toJSON());if("date"===f){var g=a.getUTCMonth()+1,h=a.getUTCDate(),i=a.getUTCFullYear(),j=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),m=a.getUTCMilliseconds();return 10>g&&(g="0"+g),10>h&&(h="0"+h),10>j&&(j="0"+j),10>k&&(k="0"+k),10>l&&(l="0"+l),100>m&&(m="0"+m),10>m&&(m="0"+m),'"'+i+"-"+g+"-"+h+"T"+j+":"+k+":"+l+"."+m+'Z"'}if(b=[],$.isArray(a)){for(c=0;c<a.length;c++)b.push($.toJSON(a[c])||"null");return"["+b.join(",")+"]"}if("object"==typeof a){for(c in a)if(hasOwn.call(a,c)){if(f=typeof c,"number"===f)d='"'+c+'"';else{if("string"!==f)continue;d=$.quoteString(c)}f=typeof a[c],"function"!==f&&"undefined"!==f&&(e=$.toJSON(a[c]),b.push(d+":"+e))}return"{"+b.join(",")+"}"}},$.evalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")},$.secureEvalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(a){return a.match(escape)?'"'+a.replace(escape,function(a){var b=meta[a];return"string"==typeof b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'}}(jQuery);var pageCheckoutEffect=function(a){var b=$('[data-orderfrom="true"]'),c=$('[data-cartforms="address"]'),d=$('[data-cartforms="time"]'),e=$('[data-cartforms="payway"]'),f=$('[data-paytype="bank"]'),g=$('[data-paytype="list"]'),h=$('[data-cartforms="invoice"]'),i=$('[data-addaddress="true"]'),j=$('[data-cartforms="idcard"]'),k=c.children(".title"),l=j.find("li:eq(0)"),m=$('[data-paytypetip="true"]'),n={hasSpace:function(a){var b=/[\s]/g;return-1==a.search(b)?!1:!0},textValid:function(a){var b=new RegExp("[`~!@#$^%*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）—|{}【】‘；：”“'。，、？]","g");return b.test(a)},noty:function(b,c,d){a.dialogBlack(c,null,3e3),a.flicker(b,"ui-note-error",!1,1,5,d)}},o={amountDisable:"disabled",events:{otherPay:"click.action.choose.otherpay",bankPay:"click.action.choose.bankpay",walletPay:"click.action.choose.walletpay"}},p={orderFrom:'[data-formorder="checkoutForm"]',otherPay:".J_otherpay",bankPay:".J_bankpay p",walletPay:".J_walletpay",input:{idCard:'input[name="inputIdCard"]',wPsw:'input[name^="wPsw"]'},showMessage:function(b,c,d){a.dialogBlack(c,null,3e3),a.flicker(b,"ui-note-error",!0,1,2,d,500)}},q={validObj:[],triggerEventFocus:["focus","blur"],triggerEventKeyDown:["keyup","change"],config:{tiptype:2,tipSweep:!1,showAllError:!1,postonce:!0,ajaxPost:!1},initConfig:function(b){var c=$.extend(!0,q.config,a.validate.util.tipmsg,b||{});return c},formValid:function(b,c,d,e){var f,g=b.curform,h=!0,i=q.initConfig(b);return"posting"===g[0].status?!1:i.postonce&&"posted"===g[0].status?!1:(g.find("[datatype]").each(function(){if(c)return!1;if($(this).is(":hidden")||"dataIgnore"===$(this).data("dataIgnore"))return!0;if(!$(this).attr("datatype"))return!1;var b=a.validate.util.getValue.call(g,$(this)),d=$(this);return f=a.validate.util.regcheck.call(g,$(this).attr("datatype"),b,$(this),i),f.passed?void 0:i.showAllError?(h&&(h=!1),!0):(e&&a.flicker(j,"ui-note-error",!0,0,2,50,500),d.focus(),h=!1,!1)}),h?(g[0].status="posting",d(g)):!1)},checkValid:function(b,c,d){{var e=b.curform;b.elem[0]}switch(focusTxt=b.elem.attr("placeholder"),returnObj=q.initConfig(b),c){case"blurValidator":var f=a.validate.util.getValue.call(e,b.elem),g=!0;switch(returnObj.evType){case"focus":focusTxt&&focusTxt.length&&b.elem.attr("placeholder","");break;case"blur":"password"!=b.elem.attr("type")||focusTxt.length?b.elem.attr("placeholder",returnObj.onEmpty):b.elem.attr("placeholder",returnObj.onError)}return g=a.validate.util.regcheck.call(e,b.elem.attr("datatype"),f,b.elem,returnObj),g.passed?(a.validate.util.showMessage.call(e,g.info,returnObj.tiptype,{dom:b.elem,type:g.type,sweep:returnObj.tipSweep},"hide"),b.elem.parents("li").removeClass("error"),d(g),!0):(b.elem.parents("li").addClass("error"),a.validate.util.showMessage.call(e,g.info,returnObj.tiptype,{dom:b.elem,type:g.type,sweep:returnObj.tipSweep},"hide"),d(g),!1);default:return!1}},checkIdCard:function(a){var b=$(this),c={elem:b,curform:p.module,onShow:"请填写收货人身份证号码",onFocus:"请输入15/18位身份证号码",onCorrect:"",onEmpty:"请填写收货人身份证号码",onError:"身份证格式有误",evType:a.type};q.checkValid(c,"blurValidator",function(a){a.passed&&c.elem.parent().parent().next().hide()},!1)},checkPassWord:function(a){var b=$(this),c={elem:b,curform:p.module,onShow:"请输入密码",onFocus:"6-20位字母、数字或符号组成",onCorrect:"",onEmpty:"请输入6-20位密码",onError:"6-20位字母、数字或符号组成",evType:a.type};q.checkValid(c,"blurValidator",function(){},!1)}},r={localHref:function(a){var b=document.createElement("a");return b.href=a,{num:parseInt(/[0-4]{1}/g.exec(b.pathname),10),source:a,file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],query:b.search,params:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}()}}},s={removeTxt:function(){var a=$(this),b=a.parent().children(".controls:eq(0)").children("input");b.val()&&""!=b.val()&&b.val("")}},t={runTime:function(){var b=$('[data-countTime="true"]'),c={elem:b,container:".count-time",startTime:parseInt(b.attr("data-cartTime")),timeStamp:{day:"",hour:"",min:":",sec:""},halfwayTime:!1,action:"defined",callback:!0,callbackFunction:function(){this.html("00:00")}};!isNaN(c.startTime)&&c.startTime>0&&a.countDown(c)}},u={detect:function(){return this.is(":hidden")}},v={init:function(){var a=$(this),b={elem:a,next:a.next(),toggle:a.parent().data("toggle"),collapse:a.parent().data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!1};b.collapse&&v.slide.toggle.call(b)},slide:{toggle:function(){this.next.length&&u.detect.call(this.next)?(this.child.addClass(this.toggle),this.next.slideDown(),this.scrol&&v.slide.scrol.call(this.elem)):(this.remove&&this.child.removeClass(this.toggle),this.next.slideUp())},up:function(){this.next.length&&!u.detect.call(this.next)&&(this.child.removeClass(this.toggle),this.next.slideUp())},down:function(){this.elemLink.length&&u.detect.call(this.elemLink)&&this.elemLink.slideDown()},scrol:function(){$("body,html").animate({scrollTop:this.offset().top},200)}},tab:function(){var a=this.next,b=this.index;this.elem.addClass("active").siblings().removeClass("active"),a.filter(":visible").fadeOut("fast",function(){a.eq(b).fadeIn("fast")})},noty:{address:function(b,c){var d={elem:b,elemLink:b.children("ul.nav")};a.dialogBlack(c),a.flicker(d.elem,"ui-note-error",!0,0,5,44),d.elemLink.length&&v.slide.down.call(d)},addressTip:function(b,c,d){var e={elem:b,elemLink:b.children("ul.nav")};d&&d.html(c).show(),a.flicker(e.elem,"ui-note-error",!0,0,2,50,500),e.elemLink.length&&v.slide.down.call(e)}}},w={info:{init:function(){var a=$(this),b={elem:a,radio:a.children().filter(".ico-radio"),input:a.children().filter('input[type="radio"]'),addressId:a.children('input[name="address_id"]'),neighbor:a.siblings("li"),collapse:a.parent().parent().data("collapse"),text:a.children("p:eq(0)").html(),address:a.children("p:eq(1)").length?a.children("p:eq(1)").html():null,unTitle:a.parent().prev().children('[data-unable="title"]'),unMsg:a.children('[data-unable="msg"]'),remove:!0};!b.radio.hasClass("active")&&!(1==b.input.attr("checked"))&&b.radio.addClass("active").parent().children().filter('input[type="radio"]').attr("checked",!0),b.neighbor.children().filter(".ico-radio").removeClass("active").parent().children().filter('input[type="radio"]').attr("checked",!1),b.elem.parent().prev().children(".text").text(b.text).parent().children().filter(".text-limit").text(b.address),v.init.call(b.elem.parent().prev())},_able:function(a){a.unMsg.length?a.unTitle.html(a.unMsg.html()).show():a.unTitle.hide()},_load:function(b){a.Set("WAP[address_id]",b,720,"","/"),self.location.href=self.location},_noty:function(){a.dialogBlack("收货地址不能为空！")}},addAddress:function(){var b=cartDataList();b.length>=5?a.showDialog("抱歉，地址最多为5个哦<br />可修改或删除原来地址重新添加！",{width:"auto",overClose:!1,closeBtn:!0,setClass:"ui-modal-black",buttons:!1,overShow:!1,autoClose:2e3}):self.location.href="member_addr_add.html"},wallets:{init:function(){var b=$(this),c=cartDataList();dom={elem:b,checkBox:b.children().filter(".ico-check"),isBind:parseInt(b.children('input[name="wallet"]').data("isbind")),isEnough:parseInt(b.children('input[name="wallet"]').data("enpay")),money:c.wallet,totleMoney:c.total,wallet:b.children('input[name="wallet"]'),walletPsw:b.children('input[name="wallet"]').next('input[name="wallet_password"]'),showMsg:b.children().children().filter('[data-wallet="paymsg"]'),neighbor:b.siblings("li").children().filter('input[name="pay_type"]')},isNaN(dom.isBind)||(1==dom.isBind?dom.money?void 0==dom.wallet.attr("checked")&&!dom.walletPsw.val()||"undefined"==dom.wallet.attr("checked")&&!dom.walletPsw.val()?w.wallets.elected(dom):w.wallets.cancle(dom):a.dialogBlack("您的钱包金额为0元，无法使用钱包支付！"):0==dom.isBind&&w.wallets.jump())},cancle:function(a){a.walletPsw.val("").prev().filter('input[name="wallet"]').val(""),a.checkBox.removeClass("active").parent().children('input[name="wallet"]').attr("checked",!1),a.isEnough&&$.each(a.neighbor,function(a,b){switch($(this).attr("checked",!1).parent().removeClass("disabled").children(".ico-radio").removeClass("active"),$(this).parent().is(":hidden")&&$(this).parent().slideDown(),parseInt(b.value)){case 8:$(this).parent().addClass("J_otherpay");break;case-2:$(this).attr("data-bankid","").attr("data-type","").parent().addClass("J_bankpay").children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active");break;default:$(this).parent().addClass("J_otherpay")}}),a.showMsg.length&&a.showMsg.hide()},elected:function(a){a.checkBox.addClass("active").parent().children('input[name="wallet"]').attr("checked",!0),a.isEnough&&(!isNaN(a.totleMoney-a.money)&&a.totleMoney-a.money>0?(console.log(a.totleMoney-a.money),a.neighbor.each(a.totleMoney-a.money>=12&&a.totleMoney-a.money<=2001&&a.totleMoney>=12&&a.totleMoney<=2001?function(a,b){switch($(this).attr("checked",!1).parent().removeClass("disabled").children(".ico-radio").removeClass("active"),parseInt(b.value)){case 8:!$(this).hasClass("J_otherpay")&&$(this).addClass("J_otherpay");break;case 50:!$(this).hasClass("J_otherpay")&&$(this).addClass("J_otherpay");break;case-2:!$(this).hasClass("J_bankpay")&&$(this).addClass("J_bankpay"),$(this).attr("data-bankid","").attr("data-type","").parent().children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active");break;default:!$(this).hasClass("J_otherpay")&&$(this).addClass("J_otherpay")}}:function(a,b){switch($(this).attr("checked",!1).parent().children(".ico-radio").removeClass("active"),parseInt(b.value)){case 8:$(this).parent().removeClass("J_otherpay").addClass("disabled");break;case 50:!$(this).hasClass("J_otherpay")&&$(this).addClass("J_otherpay");break;case-2:!$(this).hasClass("J_bankpay")&&$(this).addClass("J_bankpay"),$(this).attr("data-bankid","").attr("data-type","").parent().children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active");break;default:!$(this).hasClass("J_otherpay")&&$(this).addClass("J_otherpay")}})):a.neighbor.each(function(a,b){switch($(this).attr("checked",!1).parent().addClass("disabled").children(".ico-radio").removeClass("active"),parseInt(b.value)){case 8:$(this).parent().removeClass("J_otherpay");break;case 50:$(this).attr("checked",!0).parent().removeClass("J_otherpay");break;case-2:$(this).attr("data-bankid","").attr("data-type","").parent().removeClass("J_bankpay").children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active");break;default:$(this).parent().removeClass("J_otherpay")}})),a.showMsg.length&&a.showMsg.show()},jump:function(){location.href="user-wallet-bind-send.html"}},pay:{other:function(){var a=$(this),b=a.siblings("li.bankpay"),c={elem:a,radio:a.children().filter(".ico-radio"),input:a.children().filter('input[type="radio"]'),neighbor:a.siblings("li"),neighborBank:b,next:b.children(".slide-down"),toggle:b.data("toggle"),collapse:b.data("collapse"),child:b.children().filter('[class^="i-icon-arrow"]')};!c.radio.hasClass("active")&&!(1==c.input.attr("checked"))&&(c.radio.addClass("active").parent().children().filter('input[type="radio"]').attr("checked",!0),c.neighbor.children().filter(".ico-radio").removeClass("active").parent().children().filter('input[type="radio"]').attr("checked",!1),""!=c.neighborBank.children('input[type="radio"]').attr("data-bankid")&&c.neighborBank.children('input[type="radio"]').attr("data-bankid","").attr("data-type","").parent().children(".ico-radio").removeClass("active").parent().children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active"),c.collapse&&v.slide.up.call(c))},bank:{_slide:function(){var a=$(this).parent(),b={elem:a,next:a.children(".slide-down"),toggle:a.data("toggle"),collapse:a.data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!0};b.collapse&&b.next.length&&u.detect.call(b.next)?(b.child.addClass(b.toggle),b.next.slideDown(),b.scrol&&v.slide.scrol.call(b.elem)):(b.remove&&b.child.removeClass(b.toggle),b.next.slideUp())},_type:function(){var a=$(this),b={elem:a,index:a.parent().children().index(this),next:a.parent().next().children().children("ul")};!b.elem.hasClass("active")&&v.tab.call(b)},_list:function(){var a=$(this),b=a.parents("li").children('input[name="pay_type"]'),c={elem:a,next:a.parents(".slide-down"),toggle:a.parents("li").data("toggle"),collapse:a.parents("li").data("collapse"),radio:a.parents("li").children(".ico-radio"),radioNeighbor:a.parents("li").siblings().children(".ico-radio"),id:a.children("span").data("bankid"),type:parseInt(a.children("span").attr("data-type")),pay_type:parseInt(b.val()),pay_bank:parseInt(b.val()),pay:a.parent().parent().data("twipay"),payid:a.children("span").attr("data-type"),bankid:a.children("span").attr("data-bankid"),orders:b.attr("data-orders"),ispos:b.attr("data-ispos"),cashier:b.attr("data-cashier"),text:a.parents("li").children("p"),scrol:!1,remove:!1};c.pay_type<0?c.pay_type=-1*c.pay_type:c.pay_type,c.elem.hasClass("active")?"":(c.elem.addClass("active").siblings().removeClass("active").parent().siblings().children().filter("li").removeClass("active"),c.radio.addClass("active").parent().children('input[type="radio"]').attr("data-bankid",c.id).attr("data-type",c.type).attr("checked",!0),c.radioNeighbor.hasClass("active")&&c.radioNeighbor.removeClass("active").parent().children('input[type="radio"]').attr("checked",!1),c.text.html(c.elem.text()),"boolean"==typeof c.pay&&c.pay&&D.triggerTwicePayDo(c),c.collapse&&v.slide.toggle.call(c))}}},invoice:function(){var a=$(this),b={elem:a,neighbor:a.parent().siblings().children(".title"),next:a.parent().siblings(),invoiceName:a.parent().parent().find('input[name="invoice"]'),checkIcon:a.parent().parent().find("span.ico-check")};""!=b.invoiceName.val()?b.checkIcon.addClass("active"):b.invoiceName.parent().parent().is(":hidden")?b.checkIcon.addClass("active"):b.checkIcon.removeClass("active"),u.detect.call(b.next)&&b.elem.parent().slideUp().siblings().slideDown()}},x={init:function(){var b=$(this).parents('[data-formorder="checkoutForm"]'),c={elem:$(this),addressId:b.find('input[name="address_id"]'),address_id:b.find('input[name="address_id"][checked]').val(),areaId:b.find("input[name='area_id']"),area_id:b.find("input[name='area_id'][checked]").val(),areaName:b.find("input[name='area_name']"),area_name:b.find("input[name='area_name'][checked]").val(),wallet:b.find("input[name='wallet']").length?b.find("input[name='wallet']"):null,walletPsw:b.find("input[name='wallet_password']"),wallet_password:b.find("input[name='wallet_password']").val(),payType:b.find("input[name='pay_type']"),pay_type:parseInt(b.find("input[name='pay_type'][checked]").val()),pay_bank:b.find("input[name='pay_type'][checked]"),transport:b.find("input[name='transport_day']"),transport_day:b.find("input[name='transport_day'][checked]").val(),favourable_id:b.find("input[name='favourable_id']").val(),invoice:b.find("input[name='invoice']").val(),receiver:b.find('input[name^="inputReceiver"]').length?b.find('input[name^="inputReceiver"]'):!1,idCard:b.find('input[name^="inputIdCard"]').length?b.find('input[name^="inputIdCard"]'):!1};if(window.localStorage){var d=localStorage.getItem("pay_fail");if(d&&null!=d&&void 0!=d){if(d=$.evalJSON(d),d.showLayout&&d.orders){var e=new Array(d.orders,d.is_supplier,d.address_id,d.paytype_id,d.bank_id,d.is_cashier);e=rstr2b64(e.join(":")),a.showDialog("您的支付是否遇到问题？请继续支付...",{title:"您的订单已经提交",setClass:"ui-modal-doubleBtn",closeBtn:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"刷新",attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1),localStorage.removeItem("pay_fail")},onDoCompleteTo:function(a,b){b.oncomplete(!1),location.href=""!=d.isTempUser&&1==d.isTempUser?"cart-payresult.html?oi="+e+"&from=cart":"cart-payresult.html?oi="+e}})}}else x.verifyIdCard(c)}else x.verifyIdCard(c)},verifyIdCard:function(b){b.curform=$(p.orderFrom),b.onCorrect=null,b.receiver&&b.idCard?q.formValid(b,!1,function(c){var d=a.validate.empty(b.receiver.val());return d?n.hasSpace(b.receiver.val())?(p.showMessage(k,"收货人姓名不能含有空格！",39),!1):n.textValid(b.receiver.val())?(p.showMessage(k,"收货人姓名不能含有特殊符号！",39),!1):a.validate.dataType.c.test($.trim(b.receiver.val()))?(b.elem.children(".cart-time").hide(),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;"/>').appendTo(b.elem.parent()),void a.showDialog('<h3><img src="view/touch/images/common/loading-big.gif" alt="loading" /></h3><p class="c-red">正在验证</p>',{setClass:"ui-white-loading",overClose:!1,closeBtn:!1,width:80,autoCall:!0,onAutoComplete:function(d){c[0].status="normal";var e={url:"ajaxapi-getconsignessidcard.html?&s="+(new Date).getTime(),data:{consignee:b.receiver.val()},dataType:"json",type:"POST"};e.error=function(){d.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.dialogBlack("网络加载异常，请刷新页面重试!")},e.success=function(e){if(e&&null!=e&&void 0!=e)if(1==e.code&&1==e.status)d.callback(),c[0].status="posted",x.verifyForm(b),b.elem.children(".cart-time").show().parent().next().remove();else if(e.code||e.status)d.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.dialogBlack(e.msg);else{var f={url:"ajaxapi-verifyidcard.html?&s="+(new Date).getTime(),data:{consignee:b.receiver.val(),id_number:rstr2b64(b.idCard.val())},dataType:"json",type:"POST"};f.error=function(){d.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.dialogBlack("网络加载异常，请刷新页面重试!")},f.success=function(e){d.callback(),e&&null!=e&&void 0!=e?1==e.code&&1==e.status?(c[0].status="posted",x.verifyForm(b),b.elem.children(".cart-time").show().parent().next().remove()):e.code||e.status?(a.dialogBlack(e.msg),b.elem.children(".cart-time").show().parent().next().remove()):(a.flicker(l,"ui-note-error",!1,1,5,100),a.showDialog(e.msg.length?e.msg:" ",{setClass:"ui-modal-singleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"我知道了",attribute:!1}],onDoComplete:function(a,c){c.oncomplete(!1),b.elem.children(".cart-time").show().parent().next().remove()}})):(a.dialogBlack("网络加载异常，请刷新页面重试!"),b.elem.children(".cart-time").show().parent().next().remove())},$.ajax(f)}else d.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.dialogBlack("网络加载异常，请刷新页面重试!")},$.ajax(e)}})):(p.showMessage(k,"请填写1~8位中文姓名",39),!1):(p.showMessage(k,"收货人姓名不能为空！",39),!1)},!0):x.verifyForm(b)},verifyForm:function(b){if(b.pay_type<0?b.pay_type=-1*b.pay_type:b.pay_type,!(b.addressId.length&&b.areaId.length&&b.areaName.length))return v.noty.address($('[data-cartforms="address"]'),"请选择收货地址"),!1;if(!(b.addressId.is("[checked]")||b.areaId.is("[checked]")||b.areaName.is("[checked]")))return v.noty.address($('[data-cartforms="address"]'),"请选择收货地址"),!1;if(!b.addressId.is("[checked]")||!b.areaId.is("[checked]")||!b.areaName.is("[checked]")||""==b.address_id||""==b.area_id||""==b.area_name)return v.noty.address($('[data-cartforms="address"]'),"请选择收货地址"),!1;if(!b.transport.is("[checked]")&&void 0==typeof b.transport_day||!b.transport.is("[checked]")&&"undefined"==typeof b.transport_day)return v.noty.address($('[data-cartforms="time"]'),"请选择收货时间"),!1;if(null!=b.wallet&&b.wallet.is("[checked]")&&b.wallet_password.length<1&&""==b.wallet_password){var c=a.showDialog('<ul class="nav nav-list form form-horizontal">						<li class="control-group">							<span>								<input type="password" name="wPsw" maxlength="20" placeholder="请输入密码" value="" datatype="*sn6-20"/>							</span>			              </li>				          <li class="control-text validform-tips"></li>				        </ul>',{width:300,title:'请输入钱包支付密码<a href="user-wallet-reset-index.html?ref=checkout" class="fr colorblue">忘记密码？</a>',setClass:"ui-model-double",top:20,isCenter:!1,setResize:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(a,c){var e={elem:a,curform:a.parents(".modal"),onCorrect:null,wPsw:d,errorText:d.parents("li").next(".validform-tips")};q.formValid(e,!1,function(a){a[0].status="posted",e.elem.addClass(o.disabled).attr(o.disabled,!0),b.walletPsw.val(rstr2b64(e.wPsw.val())).prev().filter('input[name="wallet"]').val(1),x.subForm(b),c.oncomplete(!1)},!1)}}),d=c.message.find(p.input.wPsw);return d.off(q.triggerEventFocus[0]).on(q.triggerEventFocus[0],q.checkPassWord).off(q.triggerEventFocus[1]).on(q.triggerEventFocus[1],q.checkPassWord),d.off(q.triggerEventKeyDown[0]).on(q.triggerEventKeyDown[0],q.checkPassWord).off(q.triggerEventKeyDown[1]).on(q.triggerEventKeyDown[1],q.checkPassWord),!1}return x.subForm(b),!1},subForm:function(b){return b.payType.length>0?!b.payType.is("[checked]")&&isNaN(b.pay_type)?(v.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",m),!1):b.pay_type<1?(v.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",m),!1):void(b.transport.is("[checked]")&&b.transport_day&&b.payType.is("[checked]")&&!isNaN(b.pay_type)&&a.showDialog("订单正在提交中",{width:"auto",overClose:!1,setClass:"ui-modal-black",buttons:!1,overShow:!0,autoCall:!0,closeBtn:!1,onAutoComplete:function(c){if(b.elem.children(".cart-time").hide(),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;"/>').appendTo(b.elem.parent()),b.pay_bank.val()<0&&2===b.pay_type)var d={url:"index.php?m=flow&act=done",data:{address_id:b.address_id,area_id:b.area_id,area_name:b.area_name,transport_day:b.transport_day,paytype_id:b.pay_bank.attr("data-type"),bank_id:b.pay_bank.attr("data-bankid"),is_cashier:b.pay_bank.attr("data-cashier"),favourable_id:b.favourable_id,invoice:b.invoice,wallet:null!=b.wallet?b.wallet.val():"",wallet_password:null!=b.wallet?b.walletPsw.val():""},dataType:"json",type:"POST"};else var d={url:"index.php?m=flow&act=done",data:{address_id:b.address_id,area_id:b.area_id,area_name:b.area_name,transport_day:b.transport_day,paytype_id:b.pay_type,favourable_id:b.favourable_id,invoice:b.invoice,wallet:null!=b.wallet?b.wallet.val():"",wallet_password:null!=b.wallet?b.walletPsw.val():""},dataType:"json",type:"POST"};d.error=function(){c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.dialogBlack("网络延时，提交订单失败！")},d.success=function(d){if(c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),d&&null!=d&&void 0!=d)if(100==d.code){if(window.localStorage&&localStorage.removeItem("paytype"),d.url&&setTimeout(function(){self.location.href=d.url},500),d.orders&&8!==b.pay_type&&window.localStorage){var e=new Object;e=d,e.showLayout=1,localStorage.setItem("pay_fail",$.toJSON(e)),x.setWhiteBg(e)}}else{if(101==d.code&&d.msg)return a.showDialog("超过20分钟，购物车商品已被清空，可在购物车历史重新加入",{title:"购物车超时",setClass:"ui-modal-singleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"我知道了",attribute:!1}],onDoComplete:function(a,b){b.oncomplete(!1),self.location.href="cart.html"}}),!1;if(d.code>101&&d.msg)return 106==d.code?(b.walletPsw.val(""),a.dialogBlack(d.msg),!1):112==d.code?(a.showDialog(d.msg.length?d.msg:" ",{setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"我知道了",attribute:!1}],onDoComplete:function(a,b){b.oncomplete(!1)}}),!1):(a.dialogBlack(d.msg),!1)}else a.dialogBlack("网络延时，提交订单失败！")},$.ajax(d)}})):(v.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",m),!1)},checkPayFail:function(){if(window.localStorage){var a=localStorage.getItem("pay_fail");a&&null!=a&&void 0!=a&&(a=$.evalJSON(a),a.showLayout&&a.orders&&x.setWhiteBg(a))}},setWhiteBg:function(a){var b="",c=new Array(a.orders,a.is_supplier,a.address_id,a.paytype_id,a.bank_id,a.is_cashier);c=rstr2b64(c.join(":")),b=""!=a.isTempUser&&1==a.isTempUser?"cart-payresult.html?oi="+c+"&from=cart":"cart-payresult.html?oi="+c,$(".subSuccessBg").length||$("body").append('<div class="bg_white subSuccessBg"></div>'),$(".subSuccessBg").off("click.checkout.subSuccessBg").on("click.checkout.subSuccessBg",function(){window.location.href=b})},hidePayTypeTip:function(){(e.find(".ico-radio.active").length||e.find(".nav-group-list.active").length)&&m.hide()}},y={categorySet:function(){var a={wH:$(window).innerHeight()};0==window.orientation||180==window.orientation?y.categoryStyle(a,.5):90==window.orientation||-90==window.orientation?y.categoryStyle(a,.3):y.categoryStyle(a,.5)},categoryStyle:function(a,b){return $("#drop-bankWrap").css({height:a.wH*b+"px"}),!1}},z={init:function(){var b,c=cartDataList(),d=location.href,e=r.localHref(d);if(c.cross)b=e.params.f?"cart.html?f="+e.params.f:"cart.html",this.checkordersStatus(c.cross,c.area,"warehouse",function(d){return a.showDialog(d.message,{setClass:"ui-modal-doubleBtn",closeBtn:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:d["btn-true"],attribute:!0,mars_sead:d["btn-true-sead"]},{name:d["btn-false"],attribute:!1,mars_sead:d["btn-false-sead"]}],buttonsPos:2,buttonsStyle:"btn-purple",onDoCompleteTo:function(d,f){var g={url:"ajaxapi-relateItemsByChangeWH.html?",data:{targetWH:c.warehouse},dataType:"json",type:"POST"},h=VIP.localStorage.getItem("changing_warehouse_type")||"";g.error=function(){f.oncomplete(!1),a.redDialog("网络延时，提交订单失败！")},g.success=function(c){if(Mar.Seed.request("button","click","cart-exchange_btn","type:"+h),c&&null!=c&&void 0!=c)switch(c.code){case 0:f.oncomplete(!1),self.location.href=b;break;case 1:z.checkordersStatus(c.code,c.data,"current",function(b,c){a.showDialog('<h3><img src="view/touch/images/common/loading-big.gif" alt="loading" /></h3><p class="c-red">正在提交</p>',{setClass:"ui-white-loading",overClose:!1,closeBtn:!1,width:80,overZindex:1050,autoCall:!0,onAutoComplete:function(d){d.callback(!1),c?a.showDialog(b.message,{title:b.title,setClass:"ui-modal-btn-tips",overClose:!1,closeBtn:!1,buttons:!0,type:"defined",buttonsCus:[{name:b["btn-false"],attribute:!1}],buttonsPos:1,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1),self.location.href=e.params.f?"cart.html?f="+e.params.f:"cart.html"}}):(f.oncomplete(!1),self.location.href="index.html")}})});break;case-1:a.blackDialog("网络加载异常，请刷新页面重试");break;case-11:a.blackDialog("网络加载异常，请刷新页面重试");break;default:self.location.href="index.html"}else a.blackDialog("网络加载异常，请刷新页面重试")},$.ajax(g)},onDoComplete:function(){var a=VIP.localStorage.getItem("changing_warehouse_type")||"";Mar.Seed.request("button","click","cart_re-edit_btn","type:"+a),setTimeout(function(){self.location.href="cart-address.html?mk=1"},200)}}),Mar.Seed.request("input","click","checkout_pop_open",""),!1});else if(c.isDelivery)return this.checkordersStatus(c.isDelivery,c.isNotDeliveryGoods,"delivery",function(b){a.showDialog(b.message,{title:b.title,setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:b["btn-false"],attribute:!1},{name:b["btn-true"],attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1),self.location.href="cart-address.html?mk=1"},onDoCompleteTo:function(a,b){b.oncomplete(!1),self.location.href="cart.html"}})}),!1},checkordersStatus:function(a,b,c,d){function e(){var a=b.split(",");return a}var f={warehouse:{title:"",message:"<p>该订单只支持发货至 “"+b+"”，<br />点击继续购物，购物车将会关联该收货地址的对应商品</p>","btn-true":"继续提交","btn-false":"修改地址","btn-true-sead":"checkout_pop_true_btn","btn-false-sead":"checkout_pop_false_btn"},delivery:{title:"以下商品不支持送达该地址",message:"","btn-false":"修改地址","btn-true":"返回购物车"},current:{title:"收货地址所在站点库存不足，购物车仅剩以下商品：",message:"","btn-false":"查看购物车","btn-true":""}},g=0;switch(showDialog={warehouse:a,delivery:a,current:a},c){case"warehouse":showDialog[c]&&d(f[c]);break;case"delivery":f[c].message+='<ul class="data-list">';for(var h=0;h<e().length;h++)f[c].message+="<li><span>●</span>"+e()[h]+"</li>";f[c].message+="</ul>",f[c].message+="<p>你可以返回购物车，删除商品后继续购物或者结算</p>",showDialog[c]&&d(f[c]);break;case"current":f[c].message+='<ul class="data-list">';for(var h=0;h<b.current.length;h++)f[c].message+="<li><span>●</span>"+b.current[h].pname+'<span class="c-red">（'+b.current[h].pnum+"件）</span></li>",g++;f[c].message+="</ul>",showDialog[c]&&d(f[c],g);break;default:return!1}}},A={checkFormInput:function(){var a=$(p.input.idCard);a.on(q.triggerEventFocus[0],q.checkIdCard).on(q.triggerEventFocus[1],q.checkIdCard),a.on(q.triggerEventKeyDown[0],q.checkIdCard).on(q.triggerEventKeyDown[1],q.checkIdCard)}},B={events:function(){b.off("click.orderform.set").on("click.orderform.set",x.init),d.children(".title").off("click.toggle.time").on("click.toggle.time",v.init),d.children(".nav").children().filter("li").off("click.choose.time").on("click.choose.time",w.info.init),e.off(o.events.walletPay,p.walletPay).on(o.events.walletPay,p.walletPay,w.wallets.init).off(o.events.otherPay,p.otherPay).on(o.events.otherPay,p.otherPay,w.pay.other).off(o.events.bankPay,p.bankPay).on(o.events.bankPay,p.bankPay,w.pay.bank._slide),f.children().filter("li").off("click.choose.banktype").on("click.choose.banktype",w.pay.bank._type),g.find("li").off("click.choose.banklist").on("click.choose.banklist",w.pay.bank._list),h.children().children().children(".title").off("click.invoice.set").on("click.invoice.set",w.invoice),i.off("click.address.add").on("click.address.add",w.addAddress),j.find(".i-delete-text").off("click.remove.text").on("click.remove.text",s.removeTxt),e.find(".i-radio").parent().off("click.payTypeTip").on("click.payTypeTip",x.hidePayTypeTip),e.find(".nav-group-list").off("click.payTypeTip").on("click.payTypeTip",x.hidePayTypeTip)}},C={init:function(){B.events(),t.runTime(),z.init(),y.categorySet(),x.checkPayFail(),A.checkFormInput()}};return{init:C.init}}(hawk);$(function(){pageCheckoutEffect.init()});