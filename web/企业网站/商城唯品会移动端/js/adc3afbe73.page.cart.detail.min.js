var pageCartListEffect=function(a,b){var d={addWhileTrue:function(a,b,c){b?a.addClass(c):a.removeClass(c)}},e={amountDisable:"disabled",events:{add:"click.action.cart.add",reduce:"click.action.cart.reduce",detele:"click.action.cart.detele",delcoupon:"click.action.cart.delcoupon",user:"click.action.cart.user"}},f={module:$("#cart_list"),amountText:".amount-text",amountNum:".amount-num",amountAddBtn:'[data-action="addNum"]',amountRedBtn:'[data-action="reduceNum"]',amountClicker:".amount-action",cartCountDown:'[data-countDown="true"]',itemDelete:'[data-action="delete"]',itemDelCoupon:'[data-action="delCoupon"]',userStatus:'[data-islogin="true"]',isItemNumInit:function(){var a=$(this).siblings(f.amountRedBtn),b=$(this).siblings(f.amountAddBtn),c=e.amountDisable,h=$(this).val()==g.min,i=$(this).val()==g.max;d.addWhileTrue(a,h,c),d.addWhileTrue(b,i,c)}},g={min:1,max:12,regNum:function(a){return new RegExp("^[0-9]\\d*$").test(a)},action:{add:function(a){g.numChange(a,$(this),"add")},reduce:function(a){g.numChange(a,$(this),"reduce")},itemDel:function(a){g.delChange(a,$(this),"delete")},itemDelCoupon:function(a){g.delCoupon(a,$(this),"coupon")}},actVal:function(a,c,d,e){var f=parseInt(a,10);return this.regNum(f)?"add"==e?(f++,c.val(f),d.text(f)):(f--,c.val(f),d.text(f)):(b.dialogBlack("请输入数字"),c.val(a),d.text(a)),f},numChange:function(a,b,c){var d={elem:b,num:b.parent().children(f.amountNum),numVal:parseInt(b.parent().children(f.amountNum).val()),text:b.parent().children(f.amountText),sizeId:parseInt(b.parent().children(f.amountNum).data("size_id")),type:c};if(!d.sizeId||d.sizeId<0||"undefined"==d.sizeId)return!1;if(!d.elem.hasClass(e.amountDisable)){d.elem.addClass(e.amountDisable);var g=this.actVal(d.numVal,d.num,d.text,c);this.actionChange(d,g)}},actionChange:function(a,h){a.cartNum=$(".amount-num[data-size_id="+a.sizeId+"]"),a.parsItem=a.elem.parent(),a.amountTrigger=a.parsItem.find(f.amountClicker),a.amountTipsContainer=a.elem.parent(".amount-confirm-box"),this.checkGoodsStatus(a,h,"modify",function(){b.showDialog({width:100,height:60,setClass:"ui-modal-loading",overClose:!1,closeBtn:!1,autoCall:!0,isLoading:!0,onAutoComplete:function(f){var j={url:"index.php?s="+(new Date).getTime(),data:{m:"flow",act:"cart",step:"modify",cart_id:a.sizeId,num:h},dataType:"json",type:"POST"};j.error=function(){c.callback(),d.addWhileTrue(a.amountTrigger,!1,e.amountDisable),a.num.val(a.numVal),a.text.text(a.numVal),b.dialogBlack("网络加载异常，请刷新页面重试!")},j.success=function(b){g.endChange.call(a,b,f,function(){i.reload(f)})},$.ajax(j)}})})},delChange:function(a,c,d){var e={elem:c,coupon:parseInt(c.attr("data-useCoupon"))?parseInt(c.attr("data-useCoupon")):0};this.checkGoodsStatus(e,0,d,function(a){e.sizeId=e.elem.parents(".cartlistinner").find(".amount-confirm-box").data("size_id"),e.sizeId>0&&!isNaN(e.sizeId)&&b.showDialog(a,{setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"删除",attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(a,c){c.oncomplete(!1),b.showDialog({width:100,height:60,setClass:"ui-modal-loading",overClose:!1,closeBtn:!1,autoCall:!0,isLoading:!0,onAutoComplete:function(a){$.post("index.php?m=flow&act=cart&step=del",{cart_id:e.sizeId},function(b){g.endItemDel.call(e,b,a,function(){i.reload(a)})},"json")}})}})})},delCoupon:function(a,c,d){this.checkGoodsStatus(c,0,d,function(){b.showDialog({width:100,height:60,setClass:"ui-modal-loading",overClose:!1,closeBtn:!1,autoCall:!0,isLoading:!0,onAutoComplete:function(a){var c={url:"index.php?",data:{m:"flow",act:"bonus",step:"del"},dataType:"json",type:"GET"};c.error=function(){a.callback(),b.dialogBlack("网络加载异常，请刷新页面重试!")},c.success=function(b){g.endCouponDel.call(dom,b,a,function(){i.reload(a)})},$.ajax(c)}})})},endChange:function(a,c,g){var h=this;if(d.addWhileTrue(h.amountTrigger,!1,e.amountDisable),a&&null!=a&&void 0!=a)switch(a.code){case 1:g();break;case-1:c.callback(),d.addWhileTrue(h.elem,!0,e.amountDisable),b.dialogBlack(a.msg),h.num.val(h.numVal),h.text.text(h.numVal);break;default:c.callback(),d.addWhileTrue(h.elem,!0,e.amountDisable),1===h.numVal&&d.addWhileTrue(h.elem.siblings(f.amountClicker),!0,e.amountDisable),b.dialogBlack(a.msg),h.num.val(h.numVal),h.text.text(h.numVal)}else c.callback(),b.dialogBlack("未知错误，请刷新页面重试")},endItemDel:function(a,c,d){if(a&&null!=a&&void 0!=a)switch(a.code){case 1:d();break;case 0:c.callback(),b.dialogBlack(a.msg);break;case-1:c.callback(),self.location.href=location.href;break;default:b.dialogBlack(a.msg),c.callback()}else c.callback(),b.dialogBlack("未知错误，请刷新页面重试")},endCouponDel:function(a,c,d){if(a&&null!=a&&void 0!=a)switch(a.code){case 1:d();break;case 0:break;default:b.dialogBlack(a.msg),c.callback()}else c.callback(),b.dialogBlack("未知错误，请刷新页面重试")},checkGoodsStatus:function(a,c,d,e){var f="",g={modify:{"has-limit":"最少购买数量为："+this.min+"件","no-Coupon":""},"delete":{"has-Coupon":"删除或修改商品后，可能会导致已使用的红包，不满足条件而被自动取消使用，是否继续操作？","no-Coupon":"你要删除该商品吗？"},coupon:{"has-Coupon":"确认取消使用礼券或优惠券吗？"}},h={modify:!0,"delete":!0};switch(d){case"modify":h[d]&&("reduce"==a.type?c>=this.min?e():(b.dialogBlack(g[d]["has-limit"]),a.num.val(a.numVal),a.text.text(a.numVal)):e());break;case"delete":f='<p style="text-align:center">'+g[d]["no-Coupon"]+"</p>",a.coupon>0&&(f="<p>"+g[d]["has-Coupon"]+"</p>"),h[d]&&e(f);break;case"coupon":f='<p style="text-align:center">'+g[d]["has-Coupon"]+"</p>",e(f)}}},h={check:function(){h.checkStatus($(this),0,"login",function(a){b.showDialog(a.message,{title:a.title,setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:a["btn-false"],attribute:!1},{name:a["btn-true"],attribute:!0}],onDoComplete:function(b,c){c.oncomplete(!1),self.location.href="login.html?back_act="+a.cartUrl},onDoCompleteTo:function(a,b){b.oncomplete(!1),self.location.href="cart-edit-receive-massage.html"}})})},checkStatus:function(a,c,d,e){var f=detectUser(),g=$.cookie().wap_consumer,h=encodeURIComponent("http://"+window.location.host+"/cart.html"),i={login:{title:"您尚未登录",message:'<p style="text-align:center;display:block;">如有账号，点击登录！</p>',"btn-false":"登录","btn-true":"我没有账号",cartUrl:h}};if(""!=f.istempuser&&!isNaN(f.istempuser)&&f.istempuser){var j={url:"ajaxapi-checklogin.html",dataType:"json",type:"POST"};j.error=function(){b.dialogBlack("网络加载异常，请刷新页面重试!")},j.success=function(a){a&&null!=a&&void 0!=a?1==a.code?a.data&&a.data.isLogin?self.location.href=""!=f.isParameter?"cart-checkout.html?f="+f.isParameter:"cart-checkout.html":"A1"!=g&&g?f.openfreeregister&&!f.international&&"A2"==g?e(i[d]):self.location.href="login.html?back_act="+h:self.location.href="reg.html?back_act="+h:b.dialogBlack(a.msg):b.dialogBlack("网络加载异常，请刷新页面重试!")},$.ajax(j)}else self.location.href=""!=f.isParameter?"cart-checkout.html?f="+f.isParameter:"cart-checkout.html"}},i={reload:function(a){ajax_refresh={url:"index.php?s="+(new Date).getTime(),data:{m:"flow",act:"cart"},dataType:"json",type:"POST"},ajax_refresh.error=function(){a.callback(),b.dialogBlack("网络加载异常，请刷新页面重试!")},ajax_refresh.success=function(c){a.callback(),c&&null!=c&&void 0!=c&&c.out?(f.module.empty().html(c.out),i.lazyload(),i.countDown()):b.dialogBlack("未知错误，请刷新页面重试")},$.ajax(ajax_refresh)},countDown:function(){var a=$(f.cartCountDown);dom={elem:a,startTime:parseInt(a.attr("data-cartTime"))?parseInt(a.attr("data-cartTime")):0,timeStamp:{day:"",hour:"",min:":",sec:""},container:"span.count-time",action:"refresh",callback:!0,callbackFunction:function(){self.location.href=location.href},onDoCallback:!0,onDoComplete:function(a,b){b.complete(!0)}},!isNaN(dom.startTime)&&dom.startTime>0&&b.countDown(dom)},lazyload:function(){var a='img[data-brandlazy="true"]';b.lazyload(a)}},j={events:function(){f.module.off(e.events.add,f.amountAddBtn).on(e.events.add,f.amountAddBtn,g.action.add).off(e.events.reduce,f.amountRedBtn).on(e.events.reduce,f.amountRedBtn,g.action.reduce).off(e.events.detele,f.itemDelete).on(e.events.detele,f.itemDelete,g.action.itemDel).off(e.events.delcoupon,f.itemDelCoupon).on(e.events.delcoupon,f.itemDelCoupon,g.action.itemDelCoupon).off(e.events.user,f.userStatus).on(e.events.user,f.userStatus,h.check)}},k={init:function(){f.module.find(f.amountNum).each(f.isItemNumInit),j.events(),i.countDown(),i.lazyload()}};$(function(){k.init()})}(window,hawk);