var pageCheckoutEffect=function(a,b){var c={amountDisable:"disabled",events:{otherPaylist:"click.action.choose.otherPaylist",bankDrop:"click.action.drop.bankList",bankType:"click.action.choose.banktype",bankList:"click.action.choose.banklist",orderFailVerify:"click.action.orderFail.verify",back:"click.action.cartPayResult.back",failPsw:"click.action.fail.password",jumpLink:"click.action.jump.psw",clear:"click.action.clear.text"}},d={confusion:function(a,b,c){var d="",e=Date.parse(new Date)/1e3,d=rstr2b64(a)+":"+rstr2b64(e.toString())+":"+rstr2b64(b),c=arguments[2]?arguments[2]:"";return c.length>0&&(d+=":"+rstr2b64(c)),d}},e={orderFailBox:$(".payresult-box"),orderFailFrom:'[data-formorder="checkfailForm"]',orderFailVerify:'[data-action="OrderFailFrom"]',orderPayList:$('[data-payRepeat="list"]'),otherPayments:"li.otherpay",bankDrop:"li.bankpay p",bankType:'[data-paytype="bank"] li',bankList:"li.nav-group-list",payTypeTips:'[data-paytypetip="true"]',radio:".ico-radio",orderBack:"J_backToPrev",orderBackNew:"J_backToPrev_new",orderSetFailPsw:'[data-action="failPswSet"]',userClearCon:".btn-delete",input:{radio:'input[type="radio"]',returnUrl:'input[name="to_order_detail_url"]',failPsw:'input[name="inputFailPsw"]'},jumplink:$('[data-jumpTo="true"]')},f={triggerEventFocus:["focus","blur"],triggerEventKeyDown:["keyup","change"],action:{validOrderFail:function(a){f.formOrderFailVal(a,$(this),"order_fail_form")},validPasswordFail:function(a){f.formPswFailVal(a,$(this),"password")},clear:function(){b.empty.call($(this))}},config:{tiptype:2,tipSweep:!1,showAllError:!1,postonce:!0,ajaxPost:!1},initConfig:function(a){var c=$.extend(!0,f.config,b.validate.util.tipmsg,a||{});return c},formOrderFailVal:function(a,c){var d=c.parents(e.orderFailFrom),g={elem:c,text:c.text(),payType:d.find("input[name='pay_type']"),pay_type:d.find("input[name='pay_type'][checked]").val(),pay_bank:d.find("input[name='pay_type'][checked]"),ispos:d.find("input[name='pay_type'][checked]").attr("data-ispos"),orders:d.find("input[name='pay_type'][checked]").attr("data-orders"),bankid:d.find("input[name='pay_type'][checked]").attr("data-bankid"),cashier:d.find("input[name='pay_type'][checked]").attr("data-cashier"),old_paytype_id:d.find("input[name='old_paytype_id']"),old_bank_id:d.find("input[name='old_bank_id']")};f.formOrderFailValid(g,function(){if(g.elem.html("&nbsp;"),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" />'+g.elem.attr("data-loading-text")).appendTo(g.elem.parent()),g.pay_type&&g.pay_bank.val()<0&&2===g.pay_type)var a={url:"index.php?",data:{m:"ajax",act:"modify_order_paytype",orders:g.orders,pay_type:g.pay_bank.attr("data-type"),use_pos:g.ispos,bank_id:g.bankid,is_cashier:g.cashier,old_paytype_id:g.old_paytype_id.val(),old_bank_id:g.old_bank_id.val()},dataType:"json",type:"POST"};else var a={url:"index.php?",data:{m:"ajax",act:"modify_order_paytype",orders:g.orders,pay_type:g.pay_type,use_pos:g.ispos,old_paytype_id:g.old_paytype_id.val(),old_bank_id:g.old_bank_id.val()},dataType:"json",type:"POST"};a.error=function(){g.elem.html(g.html).next().remove(),e.showRedError("网络延时，提交订单失败")},a.success=function(a){g.elem.html(g.text).next().remove(),a&&null!=a&&void 0!=a?1==a.code?(g.bankid&&g.old_bank_id.val(g.bankid),a.repay_url?location.href=a.repay_url:8==g.pay_type&&(location.href=a.order_detail_url)):0==a.code&&b.showDialog('<p style="text-align:center;">你可在订单详情页查看</p>',{title:"订单已超时",setClass:"ui-modal-singleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"知道了",attribute:!1}],onDoComplete:function(a,b){b.oncomplete(!1),self.location.href=$(e.input.returnUrl).val()}}):e.showRedError("网络延时，提交订单失败")},$.ajax(a)})},formOrderFailValid:function(a,b){return a.pay_type<0?a.pay_type=-1*a.pay_type:a.pay_type,a.payType.length>0?!a.payType.is("[checked]")&&isNaN(a.pay_type)?(i.noty.addressTip($(e.orderPayList),"请选择支付方式",$(e.payTypeTips)),!1):a.pay_type<1?(i.noty.addressTip($(e.orderPayList),"请选择支付方式",$(e.payTypeTips)),!1):b():(i.noty.addressTip($(e.orderPayList),"请选择支付方式",$(e.payTypeTips)),!1)},formValid:function(a,c,d){var e,g=a.curform,h=!0,i=f.initConfig(a);return"posting"===g[0].status?!1:i.postonce&&"posted"===g[0].status?!1:(g.find("[datatype]").each(function(){if(c)return!1;if($(this).is(":hidden")||"dataIgnore"===$(this).data("dataIgnore"))return!0;if(!$(this).attr("datatype"))return!1;var a=b.validate.util.getValue.call(g,$(this)),d=$(this);return e=b.validate.util.regcheck.call(g,$(this).attr("datatype"),a,$(this),i),e.passed?void 0:i.showAllError?(h&&(h=!1),!0):(d.focus(),h=!1,!1)}),h?(g[0].status="posting",d(g)):!1)},formPswFailVal:function(a,c,g){var h={elem:c,curform:e.orderFailBox,onCorrect:null,psw:c.parent().prev().find(e.input.failPsw),type:g};f.formValid(h,!1,function(a){var c=d.confusion("",hex_md5(h.psw.val()));h.elem.html("&nbsp;").attr("disabled",!0),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 提交中...').appendTo(h.elem.parent());var e={url:"ajaxapi-savatempuserpwd.html?",data:{udata:c},dataType:"json",type:"POST"};e.error=function(){a[0].status="normal",h.elem.html("保 存").attr("disabled",!1).next().remove(),b.dialogBlack("网络延时，请刷新页面重试")},e.success=function(c){a[0].status="normal",h.elem.html("保 存").attr("disabled",!1).next().remove(),c&&null!=c&&void 0!=c?1==c.code?(a[0].status="posted",b.dialogBlack("设置密码成功，页面正在跳转",null,1e3),setTimeout(function(){self.location.href="member_index.html"},1e3)):b.dialogBlack(c.msg):b.dialogBlack("网络延时，请刷新页面重试")},$.ajax(e)})},checkValid:function(a,c,d){{var e=a.curform;a.elem[0]}switch(focusTxt=a.elem.attr("placeholder"),returnObj=f.initConfig(a),c){case"blurValidator":var g=b.validate.util.getValue.call(e,a.elem),h=!0;if(!a.elem.attr("datatype"))return!1;switch(returnObj.evType){case"focus":focusTxt.length&&a.elem.attr("placeholder","");break;case"blur":"password"!=a.elem.attr("type")||focusTxt.length?a.elem.attr("placeholder",returnObj.onEmpty):a.elem.attr("placeholder",returnObj.onError)}return h=b.validate.util.regcheck.call(e,a.elem.attr("datatype"),g,a.elem,returnObj),h.passed?(b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),a.elem.parents("li").removeClass("error"),d(h),!0):(a.elem.parents("li").addClass("error"),b.validate.util.showMessage.call(e,h.info,returnObj.tiptype,{dom:a.elem,type:h.type,sweep:returnObj.tipSweep},"hide"),d(h),!1);default:return!1}},checkFailPassWord:function(a){var c=$(this),d={elem:c,curform:e.moduleP,onShow:"请输入验证码11",onFocus:"6-20位字母与数字组成,不含特殊符号",onCorrect:"",onEmpty:"请输入密码",onError:"6-20位字母与数字组成",evType:a.type},g=b.validate.util.getValue.call(d.curform,d.elem);g.length>0&&g.length<6&&(d.onError="密码太短,为6-20位字母与数字组成"),f.checkValid(d,"blurValidator",function(){},!1)}},g={categorySet:function(){var a={wH:$(window).innerHeight()};0==window.orientation||180==window.orientation?g.categoryStyle(a,.5):90==window.orientation||-90==window.orientation?g.categoryStyle(a,.3):g.categoryStyle(a,.5)},categoryStyle:function(a,b){return $("#drop-bankWrap").css({height:a.wH*b+"px"}),!1}},h={detect:function(){return this.is(":hidden")}},i={init:function(){var a=$(this),b={elem:a,next:a.next(),toggle:a.parent().data("toggle"),collapse:a.parent().data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!1};b.collapse&&i.slide.toggle.call(b)},slide:{toggle:function(){this.next.length&&h.detect.call(this.next)?(this.child.addClass(this.toggle),this.next.slideDown(),this.scrol&&i.slide.scrol.call(this.elem)):(this.remove&&this.child.removeClass(this.toggle),this.next.slideUp())},up:function(){this.next.length&&!h.detect.call(this.next)&&(this.child.removeClass(this.toggle),this.next.slideUp())},down:function(){this.elemLink.length&&h.detect.call(this.elemLink)&&this.elemLink.slideDown()},scrol:function(){$("body,html").animate({scrollTop:this.offset().top},200)}},tab:function(){var a=this.next,b=this.index;this.elem.addClass("active").siblings().removeClass("active"),a.filter(":visible").fadeOut("fast",function(){a.eq(b).fadeIn("fast")})},noty:{address:function(a,c){var d={elem:a,elemLink:a.children("ul.nav")};b.dialogBlack(c),b.flicker(d.elem,"ui-note-error",!0,0,5,44),d.elemLink.length&&i.slide.down.call(d)},addressTip:function(a,c,d){var e={elem:a,elemLink:a.children("ul.nav")};d&&d.html(c).show(),b.flicker(e.elem,"ui-note-error",!0,0,2,50,500),e.elemLink.length&&i.slide.down.call(e)}}},j={pay:{other:function(){var a=$(this),b=a.siblings("li.bankpay"),c={elem:a,radio:a.children().filter(".ico-radio"),input:a.children().filter('input[type="radio"]'),neighbor:a.siblings("li"),neighborBank:b,next:b.children(".slide-down"),toggle:b.data("toggle"),collapse:b.data("collapse"),child:b.children().filter('[class^="i-icon-arrow"]')};!c.radio.hasClass("active")&&!(1==c.input.attr("checked"))&&(c.radio.addClass("active").parent().children().filter(e.input.radio).attr("checked",!0),c.neighbor.children().filter(e.radio).removeClass("active").parent().children().filter(e.input.radio).attr("checked",!1),""!=c.neighborBank.children(e.input.radio).attr("data-bankid")&&c.neighborBank.children(e.input.radio).attr("data-bankid","").attr("data-type","").parent().children(e.radio).removeClass("active").parent().children("p").html("银行卡（请选择支付卡种）").next().children().find("li.nav-group-list").removeClass("active"),c.collapse&&i.slide.up.call(c),a.parents(e.orderPayList).prev().find(e.payTypeTips).hide())},bank:{_slide:function(){var a=$(this).parent(),b={elem:a,next:a.children(".slide-down"),toggle:a.data("toggle"),collapse:a.data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!0};b.collapse&&b.next.length&&h.detect.call(b.next)?(b.child.addClass(b.toggle),b.next.slideDown(),b.scrol&&i.slide.scrol.call(b.elem)):(b.remove&&b.child.removeClass(b.toggle),b.next.slideUp())},_type:function(){var a=$(this),b={elem:a,index:a.parent().children().index(this),next:a.parent().next().children().children("ul")};!b.elem.hasClass("active")&&i.tab.call(b)},_list:function(){var a=$(this),b=a.parents("li").children('input[name="pay_type"]'),c={elem:a,next:a.parents(".slide-down"),toggle:a.parents("li").data("toggle"),collapse:a.parents("li").data("collapse"),radio:a.parents("li").children(".ico-radio"),radioNeighbor:a.parents("li").siblings().children(".ico-radio"),id:a.children("span").data("bankid"),type:parseInt(a.children("span").attr("data-type")),pay_type:parseInt(b.val()),pay_bank:parseInt(b.val()),pay:a.parent().parent().data("twipay"),payid:a.children("span").attr("data-type"),bankid:a.children("span").attr("data-bankid"),orders:b.attr("data-orders"),ispos:b.attr("data-ispos"),cashier:b.attr("data-cashier"),text:a.parents("li").children("p"),scrol:!1,remove:!1};c.pay_type<0?c.pay_type=-1*c.pay_type:c.pay_type,c.elem.hasClass("active")?"":(c.elem.addClass("active").siblings().removeClass("active").parent().siblings().children().filter("li").removeClass("active"),c.radio.addClass("active").parent().children('input[type="radio"]').attr("data-bankid",c.id).attr("data-type",c.type).attr("checked",!0),c.radioNeighbor.hasClass("active")&&c.radioNeighbor.removeClass("active").parent().children('input[type="radio"]').attr("checked",!1),c.text.html(c.elem.text()),"boolean"==typeof c.pay&&c.pay&&D.triggerTwicePayDo(c),c.collapse&&i.slide.toggle.call(c),a.parents(e.orderPayList).prev().find(e.payTypeTips).hide())}}}},k={leftTime:function(){var c=e.orderFailBox.find('[data-leftTime="true"]'),d={elem:c,startTime:parseInt(a.leftTime),timeStamp:{day:"",hour:"",min:":",sec:""},unitClass:{day:"",hour:"c-red",min:"c-red",sec:"c-red"},action:"defined",halfwayTime:!1,callback:!0,callbackFunction:function(){this.html("00:00")},callSenconds:!0};!isNaN(d.startTime)&&d.startTime>0&&b.countDown(d)}},l={init:function(){$("."+e.orderBack).removeClass(e.orderBack).addClass(e.orderBackNew),$("."+e.orderBackNew).off(c.events.back).on(c.events.back,function(a){var c=b.showDialog('该单将继续保留<span class="c-red" data-leftTime="true">00:00</span>，可在个人中心-待支付页面再次支付',{title:"你要放弃支付吗？",setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"放弃支付",attribute:!1,mars_sead:"payresult-giveup_btn"},{name:"继续支付",attribute:!0,mars_sead:"payresult-going_btn"}],onDoComplete:function(a,b){b.oncomplete(!1),self.location.href=$(e.input.returnUrl).val()},onDoCompleteTo:function(b,c){c.oncomplete(!1),f.formOrderFailVal(a,$(e.orderFailVerify),"order_fail_form_btn")}}),d={elem:c.message.find('[data-leftTime="true"]'),startTime:$.data($('[data-leftTime="true"]')[0],"seconds")-1,timeStamp:{day:"",hour:"",min:":",sec:""},unitClass:{day:"",hour:"c-red",min:"c-red",sec:"c-red"},action:"defined",halfwayTime:!1,callback:!0,callbackFunction:function(){this.html("00:00")},onDoCallback:!0,onDoComplete:function(a,b){b.complete(!0)}};!isNaN(d.startTime)&&d.startTime>0&&b.countDown(d),Mar.Seed.request("input","click","payresult-show_btn","")})}},m={jumpLinks:function(){var a=$(this);dom={elem:a,links:a.data("jumplink").toString()},""!=dom.links&&isNaN(dom.links)&&b.showDialog("动动手指设置密码吧，支付安全又快捷",{setClass:"ui-modal-doubleBtn",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"返回首页",attribute:!1,mars_sead:"receive-massage_pop_login_btn"},{name:"设置密码",attribute:!0}],onDoComplete:function(a,b){b.oncomplete(!1),self.location.href="index.html"},onDoCompleteTo:function(a,b){b.oncomplete(!1),self.location.href=location.href+"&mtp=1"}})}},n={checkFormInput:function(){var a=e.orderFailBox.find(e.input.failPsw);a.on(f.triggerEventFocus[0],f.checkFailPassWord).on(f.triggerEventFocus[1],f.checkFailPassWord),a.on(f.triggerEventKeyDown[0],f.checkFailPassWord).on(f.triggerEventKeyDown[1],f.checkFailPassWord)}},o={events:function(){e.orderPayList.off(c.events.otherPaylist,e.otherPayments).on(c.events.otherPaylist,e.otherPayments,j.pay.other).off(c.events.bankDrop,e.bankDrop).on(c.events.bankDrop,e.bankDrop,j.pay.bank._slide).off(c.events.bankType,e.bankType).on(c.events.bankType,e.bankType,j.pay.bank._type).off(c.events.bankList,e.bankList).on(c.events.bankList,e.bankList,j.pay.bank._list).off(c.events.orderFailVerify,e.orderFailVerify).on(c.events.orderFailVerify,e.orderFailVerify,f.action.validOrderFail),e.orderFailBox.off(c.events.failPsw,e.orderSetFailPsw).on(c.events.failPsw,e.orderSetFailPsw,f.action.validPasswordFail),$(e.userClearCon).off(c.events.clear).on(c.events.clear,f.action.clear),e.jumplink.off(c.events.jumpLink).on(c.events.jumpLink,m.jumpLinks)}},p={init:function(){o.events(),n.checkFormInput(),a.leftTime&&k.leftTime(),g.categorySet(),$(e.orderFailFrom).length&&l.init(),VIP.util.initScrollAd({})}};$(function(){p.init()})}(window,hawk,void 0);